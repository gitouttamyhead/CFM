<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        /* Base Styles */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f5f5f5; 
            margin: 0; 
            padding: 0;
            display: flex;
            min-height: 100vh;
        }

        /* Navigation Styles */
        .nav-container {
            width: 250px;
            background: #2c3e50;
            color: white;
            position: fixed;
            height: 100vh;
            transition: transform 0.3s ease;
        }

        .nav-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #34495e;
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            padding: 15px 20px;
            border-bottom: 1px solid #34495e;
        }

        .nav-item a {
            color: white;
            text-decoration: none;
            display: block;
        }

        .nav-item:hover {
            background: #34495e;
        }

        .nav-item.active {
            background: #3498db;
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: #2c3e50;
            border: none;
            padding: 10px;
            cursor: pointer;
        }

        .hamburger span {
            display: block;
            width: 25px;
            height: 3px;
            background: white;
            margin: 5px 0;
            transition: 0.3s;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px #0001;
            padding: 30px;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        /* Button Styles */
        .btn {
            background: #3498db;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            margin-right: 8px;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn.danger {
            background: #e74c3c;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background: rgba(0,0,0,0.3);
        }

        .modal-content {
            background: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
        }

        /* Form Styles */
        .role-select {
            padding: 4px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* Message Styles */
        .error { color: #e74c3c; margin-top: 10px; }
        .success { color: #2ecc71; margin-top: 10px; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                transform: translateX(-100%);
            }

            .nav-container.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .hamburger {
                display: block;
            }

            .hamburger.active span:nth-child(1) {
                transform: rotate(45deg) translate(5px, 5px);
            }

            .hamburger.active span:nth-child(2) {
                opacity: 0;
            }

            .hamburger.active span:nth-child(3) {
                transform: rotate(-45deg) translate(7px, -6px);
            }
        }
    </style>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- Hamburger Menu -->
    <button class="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-header">
            <h2>Come Follow Me</h2>
        </div>
        <ul class="nav-menu">
            <li class="nav-item"><a href="scripture.html">Scripture Insights</a></li>
            <li class="nav-item"><a href="gospel.html">Gospel Topics</a></li>
            <li class="nav-item"><a href="other.html">Other Insights</a></li>
            <li class="nav-item active"><a href="admin.html">Admin Dashboard</a></li>
            <li class="nav-item"><a href="#" id="navLogout">Logout</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <h1>Admin Dashboard</h1>

            <!-- Login Form -->
            <div id="login-section">
                <h2>Login</h2>
                <form id="loginForm">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <input type="password" id="loginPassword" placeholder="Password" required>
                    <button type="submit" class="btn">Login</button>
                </form>
                <div id="loginError" class="error"></div>
            </div>

            <!-- Admin Content -->
            <div id="admin-content" style="display:none;">
                <button id="addUserBtn" class="btn">Add New User</button>
                <div id="message" class="success" style="display:none;"></div>
                <table>
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersList"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <h2>Add New User</h2>
            <form id="addUserForm">
                <input type="email" id="newUserEmail" placeholder="Email" required style="width:100%;margin-bottom:10px;">
                <select id="newUserRole" class="role-select" style="width:100%;margin-bottom:10px;">
                    <option value="user">User</option>
                    <option value="editor">Editor</option>
                    <option value="admin">Admin</option>
                </select>
                <button type="submit" class="btn">Add User</button>
                <button type="button" class="btn" id="cancelAddUserBtn" style="background:#aaa;">Cancel</button>
            </form>
            <div id="addUserError" class="error"></div>
        </div>
    </div>

    <script>
    // --- Firebase Config ---
    const firebaseConfig = {
        apiKey: "AIzaSyBXyOXGktacbjg-X2tuVsmJ7nYLCwJZ5Nw",
        authDomain: "comefollowme-d097a.firebaseapp.com",
        projectId: "comefollowme-d097a",
        storageBucket: "comefollowme-d097a.firebasestorage.app",
        messagingSenderId: "725941283112",
        appId: "1:725941283112:web:7071276f065bb3b7dd081d",
        measurementId: "G-Z9HKN7M5K5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // --- Hamburger Menu Toggle ---
    const hamburger = document.querySelector('.hamburger');
    const navContainer = document.querySelector('.nav-container');
    
    hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        navContainer.classList.toggle('active');
    });

    // --- Auth State & Role Management ---
    let currentUser = null;
    let currentUserRole = null;

    function showLogin(show) {
        document.getElementById('login-section').style.display = show ? 'block' : 'none';
        document.getElementById('admin-content').style.display = show ? 'none' : 'block';
    }

    function isAdmin() {
        return currentUser && currentUserRole === 'admin';
    }

    function updateRoleUI() {
        // Hide admin link if not admin
        const adminLink = document.querySelector('.nav-item a[href="admin.html"]').parentElement;
        adminLink.style.display = isAdmin() ? 'block' : 'none';
    }

    function showMessage(message, isError = false) {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = message;
        messageDiv.className = isError ? 'error' : 'success';
        messageDiv.style.display = 'block';
        setTimeout(() => messageDiv.style.display = 'none', 3000);
    }

    auth.onAuthStateChanged(async user => {
        currentUser = user;
        if (user) {
            const userDoc = await db.collection('users').doc(user.uid).get();
            currentUserRole = userDoc.exists ? userDoc.data().role : 'user';
            
            if (isAdmin()) {
                showLogin(false);
                updateRoleUI();
                loadUsers();
            } else {
                showMessage('Access denied. Admin privileges required.', true);
                auth.signOut();
            }
        } else {
            currentUserRole = null;
            showLogin(true);
            updateRoleUI();
        }
    });

    // --- Login/Logout ---
    document.getElementById('loginForm').addEventListener('submit', async e => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        try {
            await auth.signInWithEmailAndPassword(email, password);
            document.getElementById('loginError').textContent = '';
        } catch (err) {
            document.getElementById('loginError').textContent = err.message;
        }
    });

    document.getElementById('navLogout').addEventListener('click', (e) => {
        e.preventDefault();
        auth.signOut();
    });

    // --- Load Users ---
    async function loadUsers() {
        const snapshot = await db.collection('users').get();
        const tbody = document.getElementById('usersList');
        tbody.innerHTML = '';
        
        snapshot.forEach(doc => {
            const data = doc.data();
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${data.email}</td>
                <td>
                    <select class="role-select" onchange="updateUserRole('${doc.id}', this.value)">
                        <option value="user" ${data.role === 'user' ? 'selected' : ''}>User</option>
                        <option value="editor" ${data.role === 'editor' ? 'selected' : ''}>Editor</option>
                        <option value="admin" ${data.role === 'admin' ? 'selected' : ''}>Admin</option>
                    </select>
                </td>
                <td>
                    <button class="btn danger" onclick="deleteUser('${doc.id}')">Delete</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    // --- Add User Modal ---
    const addUserModal = document.getElementById('addUserModal');
    document.getElementById('addUserBtn').onclick = () => addUserModal.style.display = 'block';
    document.getElementById('cancelAddUserBtn').onclick = () => addUserModal.style.display = 'none';

    document.getElementById('addUserForm').onsubmit = async e => {
        e.preventDefault();
        const email = document.getElementById('newUserEmail').value;
        const role = document.getElementById('newUserRole').value;
        
        try {
            // Create user in Firebase Auth
            const userCredential = await auth.createUserWithEmailAndPassword(email, 'Password1234');
            const user = userCredential.user;
            
            // Add user to Firestore
            await db.collection('users').doc(user.uid).set({
                email: email,
                role: role
            });
            
            // Send password reset email
            await auth.sendPasswordResetEmail(email);
            
            showMessage('User added successfully. Password reset email sent.');
            addUserModal.style.display = 'none';
            loadUsers();
        } catch (err) {
            document.getElementById('addUserError').textContent = err.message;
        }
    };

    // --- Update User Role ---
    window.updateUserRole = async function(userId, newRole) {
        try {
            await db.collection('users').doc(userId).update({ role: newRole });
            showMessage('User role updated successfully');
        } catch (err) {
            showMessage(err.message, true);
        }
    };

    // --- Delete User ---
    window.deleteUser = async function(userId) {
        if (!confirm('Are you sure you want to delete this user?')) return;
        
        try {
            await db.collection('users').doc(userId).delete();
            showMessage('User deleted successfully');
            loadUsers();
        } catch (err) {
            showMessage(err.message, true);
        }
    };

    // --- Hide modal on outside click ---
    window.onclick = function(event) {
        if (event.target == addUserModal) addUserModal.style.display = 'none';
    };
    </script>
</body>
</html>